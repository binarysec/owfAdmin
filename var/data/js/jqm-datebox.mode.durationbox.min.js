/*
 * jQuery Mobile Framework : plugin to provide a date and time picker.
 * Copyright (c) JTSage
 * CC 3.0 Attribution.  May be relicensed without permission/notification.
 * https://github.com/jtsage/jquery-mobile-datebox
 */
(function(a){a.extend(a.mobile.datebox.prototype.options,{themeButton:"a",themeInput:"e",useSetButton:true,repButton:true,durationSteppers:{d:1,h:1,i:1,s:1}});a.extend(a.mobile.datebox.prototype,{_durbox_run:function(){var b=this;b.drag.didRun=true;b._offset(b.drag.target[0],b.drag.target[1]);b.runButton=setTimeout(function(){b._durbox_run()},100)},_durbox_valid:function(b){if(b.toString().search(/^[0-9]+$/)===0){return parseInt(b,10)}return 0},_durbox_enter:function(d){var b=this,c=b.initDate.getEpoch();b.d.intHTML.find("input").each(function(){switch(a(this).parent().jqmData("field")){case"d":c+=(60*60*24)*b._durbox_valid(a(this).val());break;case"h":c+=(60*60)*b._durbox_valid(a(this).val());break;case"i":c+=(60)*b._durbox_valid(a(this).val());break;case"s":c+=b._durbox_valid(a(this).val());break}});b.theDate.setTime(c*1000);b.refresh()}});a.extend(a.mobile.datebox.prototype._build,{durationbox:function(){var s=this,f=this.options,k,q,g=[0,0,0,0],l,r={d:60*60*24,h:60*60,i:60},n="ui-datebox-",p=a("<div>"),c=a("<fieldset>"),h=p.clone().addClass("ui-datebox-dboxin"),j=c.clone(),e=a("<input type='"+s.inputType+"' />").addClass("ui-input-text ui-corner-all ui-shadow-inset ui-body-"+f.themeInput),m=a("<div><a href='#'></a></div>"),b={theme:f.themeButton,icon:"plus",iconpos:"bottom",corners:true,shadow:true},d=a.extend({},b,{icon:"minus",iconpos:"top"});if(typeof s.d.intHTML!=="boolean"){s.d.intHTML.empty().remove()}s.d.headerText=((s._grabLabel()!==false)?s._grabLabel():s.__("titleDateDialogLabel"));s.d.intHTML=a("<span>");if(s.inputType!=="number"){e.attr("pattern","[0-9]*")}s.fldOrder=s.__("durationOrder");for(k=0;k<=s.fldOrder.length;k++){switch(s.fldOrder[k]){case"d":case"h":case"i":case"s":q=a.inArray(s.fldOrder[k],["d","h","i","s"]);a("<div>").jqmData("field",s.fldOrder[k]).addClass("ui-block-"+["a","b","c","d"][k]).append(e.clone()).appendTo(h).prepend("<label>"+s.__("durationLabel")[q]+"</label>");s._makeEl(m,{attr:{field:s.fldOrder[k]}}).addClass("ui-block-"+["a","b","c","d"][k]).buttonMarkup(b).appendTo(c);s._makeEl(m,{attr:{field:s.fldOrder[k]}}).addClass("ui-block-"+["a","b","c","d"][k]).buttonMarkup(d).appendTo(j);break}}k=s.theDate.getEpoch()-s.initDate.getEpoch();if(k<0){k=0;s.theDate.setTime(s.initDate.getTime())}s.lastDuration=k;g[0]=parseInt(k/r.d,10);k=k%r.d;g[1]=parseInt(k/r.h,10);k=k%r.h;g[2]=parseInt(k/r.i,10);g[3]=k%r.i;h.find("input").each(function(){switch(a(this).parent().jqmData("field")){case"d":a(this).val(g[0]);break;case"h":a(this).val(g[1]);break;case"i":a(this).val(g[2]);break;case"s":a(this).val(g[3]);break}});c.addClass("ui-grid-"+["a","b","c"][s.fldOrder.length-2]).appendTo(s.d.intHTML);h.addClass("ui-grid-"+["a","b","c"][s.fldOrder.length-2]).appendTo(s.d.intHTML);j.addClass("ui-grid-"+["a","b","c"][s.fldOrder.length-2]).appendTo(s.d.intHTML);if(f.useSetButton||f.useClearButton){q=a("<div>",{"class":n+"controls"});if(f.useSetButton){a('<a href="#">'+((f.mode==="datebox")?s.__("setDateButtonLabel"):s.__("setTimeButtonLabel"))+"</a>").appendTo(q).buttonMarkup({theme:f.theme,icon:"check",iconpos:"left",corners:true,shadow:true}).on(f.clickEventAlt,function(i){i.preventDefault();s.d.input.trigger("datebox",{method:"set",value:s._formatter(s.__fmt(),s.theDate),date:s.theDate});s.d.input.trigger("datebox",{method:"close"})})}if(f.useClearButton){a('<a href="#">'+s.__("clearButton")+"</a>").appendTo(q).buttonMarkup({theme:f.theme,icon:"delete",iconpos:"left",corners:true,shadow:true}).on(f.clickEventAlt,function(i){i.preventDefault();s.d.input.val("");s.d.input.trigger("datebox",{method:"clear"});s.d.input.trigger("datebox",{method:"close"})})}if(f.useCollapsedBut){q.addClass("ui-datebox-collapse")}q.appendTo(s.d.intHTML)}if(f.repButton===false){c.on(f.clickEvent,"div",function(i){i.preventDefault();s._offset(a(this).jqmData("field"),f.durationSteppers[a(this).jqmData("field")])});j.on(f.clickEvent,"div",function(i){i.preventDefault();s._offset(a(this).jqmData("field"),f.durationSteppers[a(this).jqmData("field")]*-1)})}h.on("change","input",function(){s._durbox_enter(a(this))});if(s.wheelExists){h.on("mousewheel","input",function(i,o){i.preventDefault();s._offset(a(this).parent().jqmData("field"),((o<0)?-1:1)*f.durationSteppers[a(this).parent().jqmData("field")])})}if(f.repButton===true){c.on(s.drag.eStart,"div",function(i){l=[a(this).jqmData("field"),f.durationSteppers[a(this).jqmData("field")]];s.drag.move=true;s._dbox_delta=1;s._offset(l[0],l[1]);if(!s.runButton){s.drag.target=l;s.runButton=setTimeout(function(){s._dbox_run()},500)}});j.on(s.drag.eStart,"div",function(i){l=[a(this).jqmData("field"),f.durationSteppers[a(this).jqmData("field")]*-1];s.drag.move=true;s._dbox_delta=-1;s._offset(l[0],l[1]);if(!s.runButton){s.drag.target=l;s.runButton=setTimeout(function(){s._dbox_run()},500)}})}}});a.extend(a.mobile.datebox.prototype._drag,{durationbox:function(){var b=this,d=this.options,c=this.drag;if(d.repButton===true){a(document).on(c.eEndA,function(f){if(c.move){f.preventDefault();clearTimeout(b.runButton);b.runButton=false;c.move=false}})}}})})(jQuery);
