/*
 * jQuery Mobile Framework : plugin to provide a date and time picker.
 * Copyright (c) JTSage
 * CC 3.0 Attribution.  May be relicensed without permission/notification.
 * https://github.com/jtsage/jquery-mobile-datebox
 */
(function(a){a.extend(a.mobile.datebox.prototype.options,{themeDateHigh:"b",themeDatePick:"b",themeDate:"a",useSetButton:true,validHours:false,slen:{y:5,m:6,d:15,h:12,i:30}});a.extend(a.mobile.datebox.prototype,{_sbox_pos:function(){var b=this,f,e,d,c;b.d.intHTML.find("div.ui-datebox-sliderow-int").each(function(){f=a(this);d=f.parent().innerWidth();if(b.__("isRTL")){e=f.find("div").last()}else{e=f.find("div").first()}c=f.find("div").size()*e.outerWidth();e.css("marginLeft",((c/2)-(d/2))*-1)})}});a.extend(a.mobile.datebox.prototype._build,{slidebox:function(){var p=this,c=this.options,e,l,q,d,f,n,g=(p.d.input.val()==="")?p._startOffset(p._makeDate(p.d.input.val())):p._makeDate(p.d.input.val()),j="ui-datebox-",h=((this.options.mobVer<140)?"up-":""),k=a("<div class='"+j+"sliderow-int'></div>"),m=a("<div>"),b=a("<div>",{"class":j+"slide"});if(typeof p.d.intHTML!=="boolean"){p.d.intHTML.empty().remove()}p.d.input.on("datebox",function(o,i){if(i.method==="postrefresh"){p._sbox_pos()}});p.d.headerText=((p._grabLabel()!==false)?p._grabLabel():p.__("titleDateDialogLabel"));p.d.intHTML=a("<span>");p.fldOrder=p.__("slideFieldOrder");p._check();p._minStepFix();a('<div class="'+j+'header"><h4>'+p._formatter(p.__("headerFormat"),p.theDate)+"</h4></div>").appendTo(p.d.intHTML);p.d.intHTML.append(b);for(l=0;l<p.fldOrder.length;l++){d=m.clone().jqmData("rowtype",p.fldOrder[l]);q=k.clone().jqmData("rowtype",p.fldOrder[l]).appendTo(d);if(p.__("isRTL")===true){q.css("direction","rtl")}switch(p.fldOrder[l]){case"y":d.addClass(j+"sliderow-ym");for(e=c.slen.y*-1;e<(c.slen.y+1);e++){f=(e!==0)?((g.get(0)===(p.theDate.get(0)+e))?c.themeDateHigh:c.themeDate):c.themeDatePick;a("<div>",{"class":j+"slideyear ui-corner-all ui-btn ui-btn-"+h+f}).html(p.theDate.get(0)+e).jqmData("offset",e).jqmData("theme",f).appendTo(q)}break;case"m":d.addClass(j+"sliderow-ym");for(e=c.slen.m*-1;e<(c.slen.m+1);e++){n=p.theDate.copy([0],[0,0,1]);n.adj(1,e);f=(e!==0)?((g.get(1)===n.get(1)&&g.get(0)===n.get(0))?c.themeDateHigh:c.themeDate):c.themeDatePick;a("<div>",{"class":j+"slidemonth ui-corner-all ui-btn ui-btn-"+h+f}).html(String(p.__("monthsOfYearShort")[n.get(1)])).jqmData("offset",e).jqmData("theme",f).appendTo(q)}break;case"d":d.addClass(j+"sliderow-d");for(e=c.slen.d*-1;e<(c.slen.d+1);e++){n=p.theDate.copy();n.adj(2,e);f=(e!==0)?((g.comp()===n.comp())?c.themeDateHigh:c.themeDate):c.themeDatePick;if((c.blackDates!==false&&a.inArray(n.iso(),c.blackDates)>-1)||(c.blackDays!==false&&a.inArray(n.getDay(),c.blackDays)>-1)){f+=" "+j+"griddate-disable"}a("<div>",{"class":j+"slideday ui-corner-all ui-btn ui-btn-"+h+f}).html(n.get(2)+'<br /><span class="'+j+'slidewday">'+p.__("daysOfWeekShort")[n.getDay()]+"</span>").jqmData("offset",e).jqmData("theme",f).appendTo(q)}break;case"h":d.addClass(j+"sliderow-hi");for(e=c.slen.h*-1;e<(c.slen.h+1);e++){n=p.theDate.copy();n.adj(3,e);f=(e!==0)?c.themeDate:c.themeDatePick;if(c.validHours!==false&&a.inArray(n.get(3),c.validHours)<0){f+=" "+j+"griddate-disable"}a("<div>",{"class":j+"slidehour ui-corner-all ui-btn ui-btn-"+h+f}).html(p.__("timeFormat")===12?p._formatter('%I<span class="'+j+'slidewday">%p</span>',n):n.get(3)).jqmData("offset",e).jqmData("theme",f).appendTo(q)}break;case"i":d.addClass(j+"sliderow-hi");for(e=c.slen.i*-1;e<(c.slen.i+1);e++){n=p.theDate.copy();n.adj(4,(e*c.minuteStep));f=(e!==0)?c.themeDate:c.themeDatePick;a("<div>",{"class":j+"slidemins ui-corner-all ui-btn ui-btn-"+h+f}).html(p._zPad(n.get(4))).jqmData("offset",e*c.minuteStep).jqmData("theme",f).appendTo(q)}break}d.appendTo(b)}if(c.useSetButton||c.useClearButton){l=a("<div>",{"class":j+"controls"});if(c.useSetButton){a('<a href="#">'+p.__("setDateButtonLabel")+"</a>").appendTo(l).buttonMarkup({theme:c.theme,icon:"check",iconpos:"left",corners:true,shadow:true}).on(c.clickEventAlt,function(i){i.preventDefault();if(p.dateOK===true){p.d.input.trigger("datebox",{method:"set",value:p._formatter(p.__fmt(),p.theDate),date:p.theDate});p.d.input.trigger("datebox",{method:"close"})}})}if(c.useClearButton){a('<a href="#">'+p.__("clearButton")+"</a>").appendTo(l).buttonMarkup({theme:c.theme,icon:"delete",iconpos:"left",corners:true,shadow:true}).on(c.clickEventAlt,function(i){i.preventDefault();p.d.input.val("");p.d.input.trigger("datebox",{method:"clear"});p.d.input.trigger("datebox",{method:"close"})})}if(c.useCollapsedBut){l.addClass("ui-datebox-collapse")}l.appendTo(p.d.intHTML)}if(p.wheelExists){p.d.intHTML.on("mousewheel",".ui-datebox-sliderow-int",function(i,o){i.preventDefault();p._offset(a(this).jqmData("rowtype"),((o<0)?-1:1)*(a(this).jqmData("rowtype")==="i"?c.minuteStep:1))})}p.d.intHTML.on(c.clickEvent,".ui-datebox-sliderow-int>div",function(i){i.preventDefault();p._offset(a(this).parent().jqmData("rowtype"),parseInt(a(this).jqmData("offset"),10))});p.d.intHTML.on("vmouseover vmouseout",".ui-datebox-sliderow-int>div",function(){p._hoover(this)});p.d.intHTML.on(p.drag.eStart,".ui-datebox-sliderow-int",function(i){if(!p.drag.move){p.drag.move=true;p.drag.target=a(this);p.drag.pos=parseInt(p.drag.target.css("marginLeft").replace(/px/i,""),10);p.drag.start=p.touch?i.originalEvent.changedTouches[0].pageX:i.pageX;p.drag.end=false;i.stopPropagation();i.preventDefault()}})}});a.extend(a.mobile.datebox.prototype._drag,{slidebox:function(){var b=this,d=this.options,c=this.drag;a(document).on(c.eMove,function(f){if(c.move&&d.mode==="slidebox"){c.end=b.touch?f.originalEvent.changedTouches[0].pageX:f.pageX;c.target.css("marginLeft",(c.pos+c.end-c.start)+"px");f.preventDefault();f.stopPropagation();return false}});a(document).on(c.eEnd,function(f){if(c.move&&d.mode==="slidebox"){c.move=false;if(c.end!==false){f.preventDefault();f.stopPropagation();c.tmp=c.target.find("div").first();b._offset(c.target.jqmData("rowtype"),(b.__("isRTL")?-1:1)*(parseInt((c.start-c.end)/c.tmp.innerWidth(),10))*(c.target.jqmData("rowtype")==="i"?d.minuteStep:1))}c.start=false;c.end=false}})}})})(jQuery);